## 前言

2023 年 6 月的暑假，第一次接触了 riscv64 处理器并通过一生一芯的教程进行简单的尝试，并对此对现代 cpu 设计有了进一步的了解。这个仓库是对于 riscv64 cpu 的一些简单的设计尝试。由于时间上较为短促，暑假期间亦有其他工程和团队的比赛在同时进行，实际上的设计测试时间不足一月。完成的单周期 riscv64 cpu 包含 RV64I 和 RV64M 指令集。

等到秋招结束，并把手头一个咕咕了好久的东西搓完应该会试着尝试将其继续完善，解决流水线和高性能除法器的设计，并学习怎么样做五级流水和缓存设计

（也许这个会变成我的毕业设计？毕竟手头能拿到 Vivado 的 FPGA 板卡，说不定可以流片逝世？

## 文件夹说明

* Calculator

  这个文件夹里头存放了一些高性能运算器模块，目前完成了块内并行、块间并行的64位先行进位加法器，和128位华莱士树乘法器（booth 2位乘和 3:2 压缩 + 4:2 压缩优化）。下一个目标应该是基2、基4和基16 SRT 整数除法器设计

* v1

  该文件夹中存放了未接入 nemu 中进行测试的第一版处理器逻辑设计。在这一版设计中代码逻辑还稍微混乱，没有统一的控制器来对各个指令进行线路的控制，导致几乎所有的模块都需要对 opcode 进行 `if-else` 和 `case` 的冗长判断。虽然对于 verilator 这种 c 库模拟方式会更为友好，但是代码显得较为混乱。

* v2

  第二版成功接入了 nemu 中通过了指令测试。这版设计有了统一的控制器和立即数选择组装模块，在线路资源上更为节约。同时对指令集的特点进行了归纳，尽可能使代码更加简洁。不过由于所有指令内容几乎都是同时运算，然后再选择结果输出到总线中，c 语言模拟的正确性测试显然会更慢。最后一点是一些部件上并没有做到重复使用减少面积，例如 mul 的三条指令：`mul`、`mulsu`、`muluu` 由于架构的特点而使用了三个乘法器，显然 PPA 是不行的。

  另外的是这一版为了适配 nemu 做了许多的 debug 线路，代码略丑

v1 v2 两版也因为 c 语言模拟的问题没能将高性能运算模块加入其中（太慢了但是验证过了，如果想真正测试延迟得切回我的 windows 用 Quartus II 进行延时分析了，不过按架构而言乘法器应该达到了流水线四周期的标准）